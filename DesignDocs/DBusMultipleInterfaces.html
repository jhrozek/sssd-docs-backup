<html><head><link rel="stylesheet" href="/sssd-test2/trac.css" type="text/css" /><link rel="stylesheet" href="/sssd-test2/wiki.css" type="text/css" /></head><body><h1 id="SupportformultipleD-Businterfacesonsingleobjectpath">Support for multiple D-Bus interfaces on single object path</h1>
<p>
Related ticket(s):
</p>
<ul><li><a class="ext-link" href="https://fedorahosted.org/sssd/ticket/2339"><span class="icon">​</span>IFP: support multiple interfaces for object</a>
</li></ul><h2 id="ProblemStatement">Problem Statement</h2>
<p>
Currently our D-Bus implementation supports having only one interface registered per one object path prefix. This can be rather limiting feature since it is often useful to separate shared methods and properties under one interface that can even have the same implementation for different object types. This will soon become a serious drawback when the Infopipe starts supporting signals and new objects. SSSD already supports few specialized interfaces such as DBus.Properties and DBus.Introspectable but those are currently hardcoded to the S-Bus dispatching logic which can be avoided with direct support for multiple interfaces.
</p>
<h2 id="Currentstate">Current state</h2>
<p>
The D-Bus interface in the InfoPipe is defined by a sbus_vtable structure and associated with a single object path or an object path prefix followed by '*' wildcard. For example the current list of InfoPipe interfaces looks as follows:
</p>
<pre class="wiki">static struct sysbus_iface ifp_ifaces[] = {
    { "/org/freedesktop/sssd/infopipe", &amp;ifp_iface.vtable },
    { "/org/freedesktop/sssd/infopipe/Domains*", &amp;ifp_domain.vtable },
    { "/org/freedesktop/sssd/infopipe/Components*", &amp;ifp_component.vtable },
    { NULL, NULL },
};
</pre><p>
There is only one allowed wildcard '*' and if present it has to be the last character of the object path.
</p>
<p>
The dispatch logic is:
</p>
<ol><li>Lookup the vtable by object path from the message
</li><li>Check that the interface name is the same as the interface define in the message, if not check if the interface in the message is one of the hard coded interfaces
</li><li>Fail if the interface is invalid
</li><li>Find and execute the method handler
</li></ol><h2 id="Proposedsolution">Proposed solution</h2>
<p>
The structure sysbus_iface combines an object path (pattern) and a list of supported interfaces on this object path.
</p>
<p>
There can still be only one supported wildcard and that is '*' but it is possible to use it everywhere and multiple times in one object path.
</p>
<p>
The dispatch logic is:
</p>
<ol><li>Acquire interface and object path from D-Bus message
</li><li>Find an object path pattern that matches the object path from the message, if more than one such pattern exist then the first one defined is used
</li><li>Find a list of interfaces associated with this object path pattern, if not found continue with next pattern that matches
</li><li>Execute a message handler that is associated with both object path and interface
</li></ol><h2 id="Authors">Authors</h2>
<ul><li>Pavel Březina &lt;<a class="mail-link" href="mailto:pbrezina@redhat.com"><span class="icon">​</span>pbrezina@redhat.com</a>&gt;
</li></ul></body></html>