<html><head><link rel="stylesheet" href="/sssd-test2/trac.css" type="text/css" /><link rel="stylesheet" href="/sssd-test2/wiki.css" type="text/css" /></head><body><h1 id="Socketsfordomains">Sockets for domains</h1>
<h2 id="Problemstatement">Problem statement</h2>
<p>
Currently, sssd offers the following types of sockets, one per responder:
</p>
<ul><li>/var/lib/sss/pipes/nss
</li><li>/var/lib/sss/pipes/pac
</li><li>/var/lib/sss/pipes/pam
</li><li>/var/lib/sss/pipes/ssh
</li></ul><p>
That is good for typical OS-level operation where sssd offers services it has set up (in /etc/sssd/sssd.conf) and offers services about all domains it is IPA-enrolled to or otherwise configured.
</p>
<p>
However, if sssd is to be used as an identity and authentication services for containerized applications, each container might be run just for one domain or subset of domains configured for host's sssd. For example, sssd might be configured for domains prod.example.com, dev.example.com, cust1.example.com, cust2.example.com. The host might run four containers, and each container should have access to just one of these domains. Plus fifth container (perhaps some monitoring application) should have access to prod.example.com, cust1.example.com, and cust2.example.com.
</p>
<p>
If we want to use the sssd running on the host and take advantage of caching and common configuration, access to sssd's services would be done by mounting the sockets (or directory with the sockets) to the container. However, the current set of sockets gives access to all domains and sssd does not have any way to distinguish what the identity of the peer requesting the service. An attempt was made to add a kernel call which would allow to determine the cgroups of the peer in non-racey way but it does not look like the call will be added: <a class="ext-link" href="https://bugzilla.redhat.com/show_bug.cgi?id=1063939"><span class="icon">â€‹</span>https://bugzilla.redhat.com/show_bug.cgi?id=1063939</a>.
</p>
<h2 id="Goals">Goals</h2>
<p>
Make it possible for containers to consume services for only a subset of domains.
</p>
<p>
Make it possible for sssd to provide services only for a subset of domains, based on some criteria.
</p>
<h2 id="Proposal">Proposal</h2>
<h3 id="Idea">Idea</h3>
<p>
Since it is not possible to determine the identity of the peer (which sssd could then use to map to the list of domains it should serve), let's make it possible to create on the fly additional sockets which could then be passed to the container and which would be pre-configured to only serve certain set of domains. By reading from given socket, sssd would then know that the peer should only be handled in the context of one or set of domains.
</p>
<p>
The sockets need to be created without sssd restarting -- it needs to be online operation.
</p>
<h3 id="Interface">Interface</h3>
<p>
Add dbus call which would take a list of domains and would return directory path containing the sockets that can be used when only a given set of domains should be addressable.
</p>
<p>
Sssd is welcome to reuse the same directory when the same set of domains is requested with the next call. So there won't be another set of sockets created per each new container -- the subsequent calls will just use the already created ones. Sssd just needs to make sure the list of domains matches.
</p>
<p>
Q: should there also be a list of responders that should be supported? Would that be useful for some use cases, possibly making for more secure setup?
</p>
</body></html>