<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Global Catalog Lookups in SSSD &#8212; sssd 1.15.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.15.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">sssd 1.15.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="global-catalog-lookups-in-sssd">
<h1>Global Catalog Lookups in SSSD<a class="headerlink" href="#global-catalog-lookups-in-sssd" title="Permalink to this headline">¶</a></h1>
<p>Related tickets:</p>
<ul class="simple">
<li><a class="reference external" href="https://fedorahosted.org/sssd/ticket/1557">​RFE Use the Global Catalog in SSSD for the AD
provider</a></li>
<li><a class="reference external" href="https://fedorahosted.org/sssd/ticket/1032">​RFE sssd should support DNS
sites</a></li>
</ul>
<div class="section" id="problem-statement">
<h2>Problem Statement<a class="headerlink" href="#problem-statement" title="Permalink to this headline">¶</a></h2>
<p>Currently SSSD uses the standard LDAP interface of Active Directory to
lookup users and groups when joined to an Active Directory domain. But
the LDAP interface only offers information for users and groups of the
local domain and not from the whole forest. This information is
available in the Global Catalog of an Active Directory domain.</p>
<p>To make lookups of users and groups from the whole forest easier SSSD
should use the Global Catalog instead of the standard LDAP interface for
the lookups.</p>
<p>Additionally SSSD should provide an interface to allow other
applications to do Global Catalog lookups. Initially it is sufficient to
offer SID-to-Name and Name-to-SID lookups if SSSD is running on an IPA
server.</p>
</div>
<div class="section" id="overview-view-of-the-solution">
<h2>Overview view of the solution<a class="headerlink" href="#overview-view-of-the-solution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-components">
<h3>General components<a class="headerlink" href="#general-components" title="Permalink to this headline">¶</a></h3>
<div class="section" id="service-discovery">
<h4>Service discovery<a class="headerlink" href="#service-discovery" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>DNS lookup for any AD DC</li>
<li>CLDAP query to find the site of the client</li>
<li>DNS lookup for a Global Catalog server from the local site, fall back
to any Global catalog server</li>
</ol>
</div>
<div class="section" id="authentication-against-the-global-catalog">
<h4>Authentication against the Global Catalog<a class="headerlink" href="#authentication-against-the-global-catalog" title="Permalink to this headline">¶</a></h4>
<p>GSSAPI with keytabs will be used for authentication.</p>
<p>If the SSSD client is joined to an AD the keytab is created during the
join process.</p>
<p>If SSSD is running on an IPA server with trust configured, the keytab
will be generated by samba. It has to be created and updated when trust
is established or the trust password is changed. Additionally there
should be a method to generate the keytab if it does not exist even if
there is no change in the trust state.</p>
</div>
</div>
<div class="section" id="new-nss-responder-calls-for-sid-to-name-and-name-to-sid-lookups">
<h3>New NSS-Responder calls for SID-to-Name and Name-to-SID lookups<a class="headerlink" href="#new-nss-responder-calls-for-sid-to-name-and-name-to-sid-lookups" title="Permalink to this headline">¶</a></h3>
<p>Two new calls should be added to the NSS-Responder to give other
applications (the first user would be the FreeIPA directory server) a
simple interface for SID-to-Name and Name-to-SID lookups. It has to be
sorted out if and how those two new call will interact with lookup by
SID feature described in
<a class="reference external" href="https://fedorahosted.org/sssd/ticket/1559">#1559</a> &#8220;Use the
getpwnam()/getgrnam() interface as a gateway to resolve SID to Names&#8221;.</p>
<div class="section" id="memory-cache-for-the-new-lookups">
<h4>Memory cache for the new lookups<a class="headerlink" href="#memory-cache-for-the-new-lookups" title="Permalink to this headline">¶</a></h4>
<p>To speed up lookup the new calls should be able to use the memory cache.</p>
</div>
</div>
</div>
<div class="section" id="implementation-details">
<h2>Implementation details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h2>
<p>Since the Global Catalog is just an LDAP server running on a
non-standard port the general LDAP lookup code would not need much
change if any. But resolving the Global Catalog server would be a bit
different because before the actual DNS service record lookup the site
has to be determined.</p>
<p>I think it is sufficient to determine the site on startup and when SSSD
switches from offline to online.</p>
<p>To decode the blob returned by the CLDAP request libndr-nbt from the
samba4-libs package would be useful. Since libndr-krb5pac is already
used in the PAC responder I think it is ok to add this new dependency
here.</p>
<div class="section" id="environments-with-trusts">
<h3>Environments with trusts<a class="headerlink" href="#environments-with-trusts" title="Permalink to this headline">¶</a></h3>
<p>In an environment with trust it must be possible to handle multiple open
connections to Global Catalogs of different forests.</p>
<p>According to
<a class="reference external" href="http://technet.microsoft.com/en-us/library/cc772808%28v=ws.10%29.aspx">​http://technet.microsoft.com/en-us/library/cc772808%28v=ws.10%29.aspx</a>
referrals are used during Kerberos requests to guide the client to the
right KDC. I have not found a similar document for LDAP requests to the
Global Catalog. I have to find out if it is possible to work with
referrals here, too or if it is needed to read the trusted domain
objects
(<a class="reference external" href="http://msdn.microsoft.com/en-us/library/cc223754.aspx">​http://msdn.microsoft.com/en-us/library/cc223754.aspx</a>)
from the Global Catalog.</p>
</div>
<div class="section" id="new-nss-responder-calls">
<h3>New NSS responder calls<a class="headerlink" href="#new-nss-responder-calls" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="how-to-test">
<h2>How to test<a class="headerlink" href="#how-to-test" title="Permalink to this headline">¶</a></h2>
<p>Since the Global Catalog lookups just replace the current lookup methods
SSSD should just behave as before (Regression testing).</p>
<p>Additional the following changes might be visible on the user or admind
level.</p>
<div class="section" id="ad-provider">
<h3>AD provider<a class="headerlink" href="#ad-provider" title="Permalink to this headline">¶</a></h3>
<p>If the SSSD client is joined to a Windows domain which is part of a
forest, Global Catalog lookups should be able to resolve all users and
groups in the forest and not only the ones from the joined domain.</p>
</div>
<div class="section" id="ipa-provider-running-on-a-freeipa-server">
<h3>IPA provider running on a FreeIPA server<a class="headerlink" href="#ipa-provider-running-on-a-freeipa-server" title="Permalink to this headline">¶</a></h3>
<p>If the FreeIPA server is able to use SSSD for SID-to-Name and
Name-to-SID lookups running winbind on the FreeIPA server is not needed
anymore.</p>
</div>
</div>
<div class="section" id="author-s">
<h2>Author(s)<a class="headerlink" href="#author-s" title="Permalink to this headline">¶</a></h2>
<p>Sumit Bose &lt;<a class="reference external" href="mailto:sbose&#37;&#52;&#48;redhat&#46;com">​sbose<span>&#64;</span>redhat<span>&#46;</span>com</a>&gt;</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Global Catalog Lookups in SSSD</a><ul>
<li><a class="reference internal" href="#problem-statement">Problem Statement</a></li>
<li><a class="reference internal" href="#overview-view-of-the-solution">Overview view of the solution</a><ul>
<li><a class="reference internal" href="#general-components">General components</a><ul>
<li><a class="reference internal" href="#service-discovery">Service discovery</a></li>
<li><a class="reference internal" href="#authentication-against-the-global-catalog">Authentication against the Global Catalog</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-nss-responder-calls-for-sid-to-name-and-name-to-sid-lookups">New NSS-Responder calls for SID-to-Name and Name-to-SID lookups</a><ul>
<li><a class="reference internal" href="#memory-cache-for-the-new-lookups">Memory cache for the new lookups</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-details">Implementation details</a><ul>
<li><a class="reference internal" href="#environments-with-trusts">Environments with trusts</a></li>
<li><a class="reference internal" href="#new-nss-responder-calls">New NSS responder calls</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-test">How to test</a><ul>
<li><a class="reference internal" href="#ad-provider">AD provider</a></li>
<li><a class="reference internal" href="#ipa-provider-running-on-a-freeipa-server">IPA provider running on a FreeIPA server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#author-s">Author(s)</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/DesignDocs/GlobalCatalogLookups.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">sssd 1.15.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Red Hat.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>