<html><head><link rel="stylesheet" href="/sssd-test2/trac.css" type="text/css" /><link rel="stylesheet" href="/sssd-test2/wiki.css" type="text/css" /></head><body><h1 id="Donotalwaysoverridehomedirectorywithsubdomain_homedirvalueinservermode">Do not always override home directory with subdomain_homedir value in server mode</h1>
<p>
Related ticket(s):
</p>
<ul><li><a class="ext-link" href="https://fedorahosted.org/sssd/ticket/2583"><span class="icon">​</span>https://fedorahosted.org/sssd/ticket/2583</a>
</li></ul><h3 id="Problemstatement">Problem statement</h3>
<p>
Prior to sssd 1.12, we didn't have the ability to read home directory values from AD in AD-IPA trust setups at all. Instead, we always used the <tt>subdomain_homedir</tt> value. We can read custom LDAP values now, but in order to stay backwards-compatible, we kept using the <tt>subdomain_homedir</tt> value.
</p>
<h3 id="Usecases">Use cases</h3>
<p>
Users from AD with POSIX attributes want to use individually set value for home directory.
</p>
<h3 id="Overviewofthesolution">Overview of the solution</h3>
<p>
<tt>subdomain_homedir</tt> for SSSD in server mode should support '%o' template expansion (The original home directory retrieved from the identity provider). In case when <tt>subdomain_homedir</tt> would be expanded to an empty string ('subdomain_homedir=%o' and AD user without POSIX attributes) SSSD should not error out but <tt>fallback_homedir</tt> should be utilized instead.
</p>
<h3 id="Implementationdetails">Implementation details</h3>
<ul><li>Extend set of attributes returned by <tt>get_object_from_cache()</tt> by SYSDB_HOMEDIR attribute.
</li><li>Update <tt>apply_subdomain_homedir()</tt>
<ul><li>to parse AD home dirrctory from ldb_msg
</li><li>do not call <tt>store_homedir_of_user()</tt> if value of expanded home directory is an empty string.
</li></ul></li><li>Extend interface of <tt>get_subdomain_homedir_of_user()</tt> to accept AD home directory as parameter.
</li></ul><h3 id="Configurationchanges">Configuration changes</h3>
<p>
No configuration changes are proposed.
</p>
<h3 id="HowToTest">How To Test</h3>
<ol><li>On SSSD in server mode
<ul><li>For AD user with posix attributes set home directory attribute
<ul><li>in sssd.conf set <tt>subdomain_homedir</tt> option to '%o'
</li><li>invalidate cache (sss_cache) and restart SSSD
</li><li>call <tt>getent passwd user</tt> and check that home directory reflects value from AD
</li></ul></li><li>For AD user <tt>without</tt> posix attributes
<ul><li>in sssd.conf set <tt>subdomain_homedir</tt> option to %o and <tt>fallback_homedir</tt> to /home/%u
</li><li>invalidate cache (sss_cache) and restart SSSD
</li><li>call <tt>getent passwd user</tt> and check that home directory reflects <tt>fallback_homedir</tt>
</li></ul></li></ul></li><li>On SSSD acting as IPA client
<ul><li>Check that results are the same as on SSSD in server mode and that local <tt>fallback_homedir</tt> is ignored
</li></ul></li></ol><h3 id="Authors">Authors</h3>
<p>
<a class="mail-link" href="mailto:preichl@redhat.com"><span class="icon">​</span>preichl@redhat.com</a>
</p>
</body></html>