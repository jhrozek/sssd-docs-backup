<html><head><link rel="stylesheet" href="/sssd-test2/trac.css" type="text/css" /><link rel="stylesheet" href="/sssd-test2/wiki.css" type="text/css" /></head><body><p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="#DebuggingandtroubleshootingSSSD">Debugging and troubleshooting SSSD</a>
    <ol>
      <li>
        <a href="#Lettoolshelpyou">Let tools help you!</a>
      </li>
      <li>
        <a href="#SSSDdebuglogs">SSSD debug logs</a>
      </li>
      <li>
        <a href="#TroubleshootingSUDO">Troubleshooting SUDO</a>
      </li>
      <li>
        <a href="#TroubleshootingDNSupdates">Troubleshooting DNS updates</a>
      </li>
      <li>
        <a href="#TroubleshootingUserInformation">Troubleshooting User Information</a>
      </li>
      <li>
        <a href="#TroubleshootingAuthenticationPasswordChangeandAccessControl">Troubleshooting Authentication, Password Change and Access Control</a>
      </li>
      <li>
        <a href="#Bugreports">Bug reports</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h1 id="DebuggingandtroubleshootingSSSD">Debugging and troubleshooting SSSD</h1>
<p>
This document should help users who are trying to troubleshoot why their SSSD
setup is not working as expected. After following the steps described here,
the user should be able to either fix the configuration himself or provide
the developers/support a complete set of debug information to follow on
<a class="wiki" href="https://docs.pagure.org/sssd-test2/Reporting_sssd_bugs.html">in a bug report</a>.
</p>
<p>
The SSSD provides two major features - obtaining information about users
and authenticating users. Each of these hooks into different system APIs
and should be viewed separately. However, a successfull authentication
can only be performed when the information about a user can be retrieved,
so if authentication doesn't work in your case, please make sure you can
at least obtain info from about the user with <tt>getent passwd</tt> or <tt>id</tt>.
</p>
<h2 id="Lettoolshelpyou">Let tools help you!</h2>
<p>
Rather than hand-crafting the SSSD and system configuration
yourself, it's much wiser to let an automated tool do its job. If
you want to connect an IPA client, use <tt>ipa-client-install</tt>. For
connecting a machine to an Active Directory domain,
<a class="ext-link" href="http://freedesktop.org/software/realmd/"><span class="icon">​</span>realmd</a> is the best tool for
the job. If you're on RHEL-6, where <tt>realmd</tt> is not available, you can still
<a class="ext-link" href="https://jhrozek.wordpress.com/2014/03/13/enrolling-an-active-directory-rhel-6-client-machine-using-adcli/"><span class="icon">​</span>use adcli from EPEL</a>.
</p>
<p>
The <tt>authconfig</tt> utility can also help you set up the Name Service Switch
and/or the PAM stack while allowing you to use a custom <tt>sssd.conf</tt> with the
<tt>--enablesssd</tt> and <tt>--enablesssdauth</tt> options. Please note these options
only enable SSSD in the NSS and PAM stacks but do not configure the SSSD
service itself!
 
</p>
<h2 id="SSSDdebuglogs">SSSD debug logs</h2>
<p>
Each process that SSSD consists of is represented by a section in
the <tt>sssd.conf</tt> config file. To enable debugging persistently across SSSD service restarts, put the directive
<tt>debug_level=N</tt>, where N typically stands for a number between 1 and 10 into
the particular section. Levels up to 3 should log mostly failures (although
we haven't really been consistent especially earlier in the SSSD development)
and anything above level 8 provides a large number of log messages. Level
6 might be a good starting point for debugging problems. You can also use the <a class="ext-link" href="https://jhrozek.fedorapeople.org/sssd/git/man/sss_debuglevel.8.html"><span class="icon">​</span>sss_debuglevel(8)</a> tool to enable debugging on the fly without having to restart the daemon.
</p>
<p>
On Fedora/RHEL, the debug logs are stored under <tt>/var/log/sssd</tt>. There is
one log file per SSSD process. The services (also called responders) log
into a log file called <tt>sssd_$service</tt>, for example NSS responder logs into
<tt>/var/log/sssd/sssd_nss.log</tt>. The domain sections log into files called
<tt>sssd_$domainname.log</tt>. The short-lived helper processes also log into
their own log files, such as <tt>ldap_child.log</tt> or <tt>krb5_child.log</tt>.
</p>
<p>
Keep in mind that enabling <tt>debug_level</tt> in the <tt>[sssd]</tt> section only
enables debugging of the <tt>sssd</tt> process itself, not all the worker processes!
</p>
<h2 id="TroubleshootingSUDO">Troubleshooting SUDO</h2>
<p>
<a class="wiki" href="https://docs.pagure.org/sssd-test2/HOWTO_Troubleshoot_SUDO.html">Troubleshooting SUDO</a> - a guide to troubleshoot sudo issues 
</p>
<h2 id="TroubleshootingDNSupdates">Troubleshooting DNS updates</h2>
<p>
<a class="wiki" href="https://docs.pagure.org/sssd-test2/HOWTO_Troubleshoot_DNS_Updates.html">Troubleshooting DNS updates</a> - a guide to troubleshoot nsupdate issues
</p>
<h2 id="TroubleshootingUserInformation">Troubleshooting User Information</h2>
<p>
Before diving into the SSSD logs and config
files it is very beneficial to know how does the
<a class="ext-link" href="https://jhrozek.wordpress.com/2015/03/11/anatomy-of-sssd-user-lookup/"><span class="icon">​</span>SSSD request flow</a> looks like. Having that in mind, you can go through the following check-list to identify where the problem might be.
</p>
<p>
For even more in-depth information on SSSD's architecture, refer to <a class="ext-link" href="http://is.muni.cz/th/359290/fi_m/thesis.pdf"><span class="icon">​</span>Pavel Brezina's thesis</a>.
</p>
<p>
Please note the examples of the DEBUG messages are subject to change in future SSSD versions.
</p>
<ul><li><strong>general tips</strong>
<ol><li>To avoid SSSD caching, it is often useful to reproduce the bugs
with an empty cache or at least invalid cache. However, keep in mind
that also the cached credentials are stored in the cache! <strong>Do not</strong> remove
the cache files if your system is offline and it relies on SSSD authentication!
</li><li>Before sending the logs and/or config files to a publicly-accessible space, such as mailing lists or bug trackers, check the files for any sensitive information
</li><li>Please only send log files relevant to the occurence of the issue. Issues in log files that are mega- or gigabytes large are more likely to be skipped
</li><li>Unless the problem you're trying to diagnose is related to enumeration per, se, always reproduce the issue with <tt>enumerate=false</tt>. Triaging logs with enumeration enabled obfuscates the normal data flow.
</li></ol></li></ul><ul><li><strong>getent passwd or id doesn't print the user or getent group doesn't print the group at all</strong>
<ol><li>Is sssd running at all?
<ul><li><tt>systemctl status sssd</tt> or <tt>service sssd status</tt> would display the service status. Alternatively, check for the <tt>sssd</tt> processes with <tt>ps -ef | grep sssd</tt> or similar.
</li></ul></li><li>Is the <tt>sss</tt> module present in <tt>nsswitch.conf</tt> for all databases?
<ul><li>If there is a separate <tt>initgroups</tt> database configured, make sure it either contains the <tt>sss</tt> module as well or comment the <tt>initgroups</tt> line completely
</li></ul></li><li>Does the request reach the SSSD responder processes? Enable debugging by putting <tt>debug_level=6</tt> (or higher) into the <tt>[nss]</tt> section. Restart SSSD and check the <tt>nss</tt> log for incoming requests with the matching timestamp to your <tt>getent</tt> or <tt>id</tt> command. Here is how an incoming request looks like with SSSD-1.12:
<pre class="wiki">[sssd[nss]] [accept_fd_handler] (0x0400): Client connected!
[sssd[nss]] [sss_cmd_get_version] (0x0200): Received client version [1].
[sssd[nss]] [sss_cmd_get_version] (0x0200): Offered version [1].
[sssd[nss]] [nss_cmd_getbynam] (0x0400): Running command [17] with input [admin].
</pre>Command <tt>17</tt> is <tt>getpwnam(admin)</tt>, invoked through <tt>getent passwd admin</tt>
</li><li>If the command is reaching the NSS responder, does it get forwarded to the Data Provider? Does the Data Provider request end successfully? With SSSD 1.12, an unsuccessful request would look like this:
<pre class="wiki">[sssd[nss]] [sss_dp_issue_request] (0x0400): Issuing request for [0x4266f9:1:admin@ipa.example.com]
[sssd[nss]] [sss_dp_get_account_msg] (0x0400): Creating request for [ipa.example.com][4097][1][name=admin]
[sssd[nss]] [sss_dp_internal_get_send] (0x0400): Entering request [0x4266f9:1:admin@ipa.example.com]
[sssd[nss]] [sss_dp_get_reply] (0x1000): Got reply from Data Provider - DP error code: 1 errno: 11 error message: Fast reply - offline
[sssd[nss]] [nss_cmd_getby_dp_callback] (0x0040): Unable to get information from Data Provider
</pre>In contrast, a request that ran into completion would look like this:
<pre class="wiki">[sssd[nss]] [sss_dp_issue_request] (0x0400): Issuing request for [0x4266e9:1:admin@ipa.example.com]
[sssd[nss]] [sss_dp_get_account_msg] (0x0400): Creating request for [redhat.com][4097][1][name=admin]
[sssd[nss]] [sss_dp_internal_get_send] (0x0400): Entering request [0x4266e9:1:admin@ipa.example.com]
[sssd[nss]] [sss_dp_get_reply] (0x1000): Got reply from Data Provider - DP error code: 0 errno: 0 error message: Success (Success)
</pre>If the Data Provider request had finished completely, but you're still
not seeing any data, then chances are the search didn't match any
object. Either, way, the next step is to look into the logs from the
<tt>[domain]</tt> section. Put <tt>debug_level=6</tt> or higher into the appropriate
<tt>[domain]</tt> section, restart SSSD, re-run the lookup and continue debugging in the next section.
</li></ol></li></ul><ul><li><strong>Troubleshooting general sssd_be problems</strong>
<ol><li>The back end performs several different operations, so it might be difficult to see where the problem is at first. At the highest level, the back end performs these steps, in this order
<ul><li>The request is received from the responder
</li><li>The back end resolves the server to connect to. This step might involve locating the client site or resolving a SRV query
</li><li>The back end establishes connection to the server. In case the connection is authenticated, then a proper keytab or a certificate might be required
</li><li>Once connection is established, the back end runs the search. You should see the LDAP filter, search base and requested attributes.
</li><li>After the search finishes, the entries that matched are stored to the cache
</li><li>When the request ends (correctly or not), the status code is returned to the responder
</li></ul></li><li>Make sure the back end is in "neutral" or "online" state when you run the search.
<ul><li>With some responder/provider combinations, SSSD might run a search immediately after startup, which, in case of misconfiguration, might mark the back end offline even before the first request by the user arrives. 
</li><li>You can forcibly set SSSD into offline or online state using the SIGUSR1 and SIGUSR2 signals, see the <a class="ext-link" href="https://jhrozek.fedorapeople.org/sssd/git/man/sssd.8.html"><span class="icon">​</span>sssd(8) man page</a> for details.
</li></ul></li><li>Can the remote server be resolved? Check if the DNS servers in <tt>/etc/resolv.conf</tt> are correct. With AD or IPA back ends, you generally want them to point to the AD or IPA server directly.
<ul><li>Use the <tt>dig</tt> utility to test SRV queries, for instance <tt>dig -t SRV _ldap._tcp.ad.example.com @127.0.0.1</tt>
</li></ul></li><li>Can the connection be established with the same security properties SSSD uses?
<ul><li>Many back ends require the connection to be authenticated. In case of AD and IPA, the connection is authenticated using the system keytab, the LDAP back end often uses certificates.
</li><li><tt>ldapsearch -ZZ</tt> is useful to test problems with certificates, since SSSD uses openldap libraries under the hood.
</li><li>For debugging GSSAPI authentication, <tt>kinit</tt> is useful, often together with <tt>KRB5_TRACE</tt>. Take care to select the correct principal, especially with the AD back end. If you select the highest <tt>debug_level</tt>, 10, then <tt>ldap_child.log</tt> would contain the Kerberos tracing information as well.
</li></ul></li><li>Are the LDAP search properties correct?
<ul><li>Check if all the attributes required by the search are present on the server. This is especially important with the AD provider where the entries might not contain the POSIX attributes at all or might not have the POSIX attributes replicated to Global Catalog, in case SSSD is connecting to the GC.
</li><li>Is the search base correct, especially with trusted subdomains? Incorrect search base with an AD subdomain would yield a referral.
</li></ul></li><li>Try running the same search with the <tt>ldapsearch</tt> utility. Don't forget to use the same authentication method as SSSD uses!
</li></ol></li></ul><ul><li><strong>Assorted common SSSD problems</strong>
<ol><li>Logins take too long or the time to execute <tt>id $username</tt> takes too long.
<ul><li>First, make sure to understand <a class="ext-link" href="https://jhrozek.wordpress.com/2014/01/27/why-is-id-so-slow-with-sssd/"><span class="icon">​</span>what does `id username` do</a>. Do you really care about its performance? Chances are you're more interested in <tt>id -G</tt> performance more.
</li><li>Check out the <tt>ignore_group_members</tt> options in the <a class="ext-link" href="https://jhrozek.fedorapeople.org/sssd/1.14.1/man/sssd.conf.5.html"><span class="icon">​</span>sssd.conf(5)</a> manual page.
</li></ul></li><li><tt>getent passwd</tt> and <tt>getent group</tt> doesn't display any users or groups.
<ul><li>Enumeration is disabled by design. See the <a class="wiki" href="https://docs.pagure.org/sssd-test2/FAQ.html#WhenshouldIenableenumerationinSSSDorWhyisenumerationdisabledbydefault">FAQ page</a> for explanation
</li></ul></li><li>Changes on the server are not reflected on the client for quite some time
<ul><li>The SSSD caches identity information for some time. You can force cache refresh on next lookup using the <a class="ext-link" href="https://jhrozek.fedorapeople.org/sssd/git/man/sss_cache.8.html"><span class="icon">​</span>sss_cache(8)</a> tool.
</li><li>Please note that during login, updated information is /always/ re-read from the server
</li></ul></li><li>After enrolling the same machine to a domain with different users (perhaps a test VM was enrolled to a newly provisioned server), no users can be resolved or log in
<ul><li>Probably the new server has different ID values even if the users are named the same (like <tt>admin</tt> in an IPA domain). Currently UID changes are not supported even though <a class="ext-link" href="https://fedorahosted.org/sssd/ticket/884"><span class="icon">​</span>we plan on addressing that eventually</a>. At the moment, caches must be removed.
</li></ul></li></ol></li></ul><ul><li><strong>Common LDAP provider issues</strong>
<ol><li>When running <tt>id user</tt>, no groups are displayed.
</li><li>When running <tt>getent group $groupname</tt>, no group members are displayed
<ul><li>In both cases, make sure the selected schema is correct. By default, SSSD will use the more common RFC 2307 schema. The difference between RFC 2307 and RFC 2307bis is the way which group membership is stored in the LDAP server. In an RFC 2307 server, group members are stored as the multi-valued attribute memberuid which contains the name of the users that are members. In an RFC2307bis server, group members are stored as the multi-valued attribute member (or sometimes uniqueMember) which contains the DN of the user or group that is a member of this group. RFC2307bis allows nested groups to be maintained as well.
</li></ul></li><li>If using the LDAP provider with Active Directory, the back end randomly goes offline and performs poorly.
<ul><li>make sure the referrals are disabled. See the  <a class="wiki" href="https://docs.pagure.org/sssd-test2/FAQ.html#WhenshouldIenableenumerationinSSSDorWhyisenumerationdisabledbydefault">FAQ page</a> for explanation. Also please consider migrating to the AD provider.
</li><li>The AD provider disabled referral support by default, so there's no need to disable referrals explicitly
</li></ul></li><li>When enumeration is enabled, or when the underlying storage has issues, the <tt>sssd_be</tt> process is being killed by <tt>SIGTERM</tt> or even <tt>SIGKILL</tt>
<ul><li>With huge directories, the <tt>sssd_be</tt> process takes a long time to store the entries to cache. The cache writes are blocking, so when <tt>sssd_be</tt> writes to the cache, it doesn't answer heartbeat pings from the <tt>sssd</tt> process. As a consequence, the <tt>sssd</tt> process might consider the back end as stuck and forcibly kills it. You can increase the heartbeat interval by raising the value of the <tt>timeout</tt> option.
</li></ul></li><li>For configuration with <tt>id_provider=ldap</tt> and <tt>auth_provider=ldap</tt>, retrieving user information works, but authetication does not
<ul><li>Please note that user authentication is typically retrieved over unecrypted channel (unless <tt>ldap_id_use_start_tls</tt> is enabled), but authentication always happens over an ecrypted channel. Checking for certificate errors should be the first step. To test authentication manually, you can perform a base-search against the user entry together with ldapsearch's <tt>-Z</tt> option.
</li></ul></li></ol></li></ul><ul><li><strong>Common IPA provider issues</strong>
<ol><li>In an IPA-AD trust setup, <tt>getent group $groupname</tt> doesn't display any group members
</li><li>In an IPA-AD trust setup, <tt>id $username</tt> doesn't display any groups
<ul><li>This is expected with older SSSD and FreeIPA versions. In order to display the group members for groups and groups for user, you need to have at least SSSD 1.12 on the client and FreeIPA server 4.1 or newer at the same time
</li></ul></li><li>In an IPA-AD trust setup, IPA users can be resolved, but AD trusted users can't
<ul><li>The IPA client machines query the SSSD instance on the IPA server for AD users. If the client logs contain errors such as:
<pre class="wiki">    [ipa_s2n_exop_done] (0x0040): ldap_extended_operation result: Operations error(1), Failed to handle the request.
</pre>or:
<pre class="wiki">    [ipa_s2n_get_user_done] (0x0040): s2n exop request failed.
</pre>Check if AD trusted users be resolved on the server at least. Enable debugging for the SSSD instance on the IPA server and take a look at SSSD logs there. Chances are the SSSD on the server is misconfigured or maybe not running at all.
</li></ul></li><li>In an IPA-AD trust setup, AD trust users cannot be resolved or secondary groups are missing on the IPA server
<ul><li>This can be caused by AD permissions issues if the below errors are seen in the logs:
<pre class="wiki">    [sdap_ad_resolve_sids_done] (0x0020): Unable to resolve SID S-1-5-21-101891098-1139187330-4192773280-XXXXXX - will try next sid.
</pre>Validate permissions on the AD object printed in the logs. This can checked by manually performing ldapsearch with the same LDAP filter and kerberos credentials that SSSD uses(one-way trust uses keytab in <tt>/var/lib/sss/keytabs/</tt> and two-way trust uses host principal in <tt>/etc/krb5.keytab</tt>).
</li></ul></li></ol></li></ul><ul><li><strong>Common AD provider issues</strong>
<ol><li>How do I set up the AD provider?
<ul><li>There is a dedicated page about <a class="wiki" href="https://docs.pagure.org/sssd-test2/Configuring_sssd_with_ad_server.html">AD provider setup</a>
</li></ul></li><li>Many users can't be displayed at all with ID mapping enabled and SSSD domain logs contain error message such as
<pre class="wiki">    [sdap_idmap_sid_to_unix] (0x0080): Could not convert objectSID [S-1-5-21-101891098-1139187330-4192773280-XXXXXX]
</pre>Where XXXXXX is a number larger than 200000, then check the <tt>ldap_idmap_range_size</tt> option. You'll likely want to increase its value. Keep in mind the largest ID value on a POSIX system is 2<sup>32.
</sup></li><li>The POSIX attributes disappear randomly after login
<ul><li>SSSD looks the user's group membership in the Global Catalog to make sure even the cross-domain memberships are taken into account. Chances are the POSIX attributes are not replicated to the Global Catalog. You can disable the Global catalog lookups by disabling the <tt>ad_enable_gc</tt> option, but you'll lose cross-domain memberships. Alternatively, modify the AD schema to replicate the POSIX attribute to the Global Catalog.
</li></ul></li><li>After selecting a custom <tt>ldap_search_base</tt>, the group membership no longer displays correctly.
<ul><li>If you use a non-standard LDAP search bases, please disable the TokenGroups performance enhancement by setting <tt>ldap_use_tokengroups=False</tt>. Otherwise, the AD provider would receive the group membership via a special call that is not restricted by the custom search base which causes unpredictable results
</li></ul></li><li>SSSD keeps connecting to the forest root domain, which is not reachable and the whole daemon switches to offline mode as a result
<ul><li>SSSD would connect to the forest root in order to discover all subdomains in the forest in case the SSSD client is enrolled with a member of the forest, not the forest root. This is because only the forest root knows all the subdomains, the forest member only knows about itself and the forest root.
</li><li>In case the SSSD client is behind a firewall preventing connection to the forest root, you can set <tt>subomains_provider=none</tt> to disable the forest root lookup. However, only users and groups from the domain SSSD is enrolled with would be available.
</li><li>Alternatively, starting with version 1.14.1, you can use the option <tt>ad_enabled_domains</tt> to selectively enable only the reachable domains
</li></ul></li><li>A group my user is a member of doesn't display in the 'id' output
<ul><li>Cases like this are best debugged from an empty cache
</li><li>Check if the group GID appears in the output of <tt>id -G</tt> first.
<ul><li>In case the group is not present in the <tt>id -G</tt> output at all, there is something up with the initgroups part. Check the schema and look for anything strange during the initgr operation in SSSD back end logs.
</li><li>If the group is present in <tt>id -G</tt> output but not in <tt>id</tt> output (or a subsequent <tt>id</tt> output) then there's something wrong with resolving the group GIDs with <tt>getgrgid()</tt>
</li></ul></li></ul></li></ol></li></ul><h2 id="TroubleshootingAuthenticationPasswordChangeandAccessControl">Troubleshooting Authentication, Password Change and Access Control</h2>
<p>
In order for authentication to be successfull, the user information must
be accurately provided first. Before debugging authentication, please
make sure the user information is resolvable with <tt>getent passwd $user</tt>
or <tt>id $user</tt>. Failing to retrieve the user info would also manifest in
the secure logs or the journal with message such as:
</p>
<pre class="wiki">    pam_sss(sshd:account): Access denied for user admin: 10 (User not known to the underlying authentication module)
</pre><p>
Authentication happens from PAM's <tt>auth</tt> stack and corresponds to SSSD's
<tt>auth_provider</tt>. Access control takes place in PAM <tt>account</tt> phase and
is linked with SSSD's <tt>access_provider</tt>. And lastly, password changes go
through the <tt>password</tt> stack on the PAM side to SSSD's <tt>chpass_provider</tt>.
</p>
<p>
If the user info can be retrieved, but authentication fails, the first place
to look into is <tt>/var/log/secure</tt> or the system journal. Look for messages
from <tt>pam_sss</tt>. Please note that not all authentication requests come through
SSSD. Notably, SSH key authentication and GSSAPI SSH authentication happen
directly in SSHD and SSSD is only contacted for the <tt>account</tt> phase.
</p>
<ul><li><strong>Troubleshooting general authentication problems</strong>
<ol><li>The PAM-aware application starts the PAM conversation. Depending on the PAM stack configuration, the <tt>pam_sss</tt> module would be contacted.
<ul><li>To debug the authentication process, first check in the secure log or journal if <tt>pam_sss</tt> is called at all. If you don't see <tt>pam_sss</tt> mentioned, chances are your PAM stack is misconfigured. If you see <tt>pam_sss</tt> being contacted, enable debugging in <tt>pam</tt> responder logs
</li></ul></li><li>SSSD's PAM responder receives the authentication request and in most cases forwards it to the back end. Please note that unlike identity requests, the authentication/access control is typically not cached and always contacts the server.
<ul><li>The PAM responder logs should show the request being received from the pam stack and then forwarded to the back end.
</li><li>If you see the authentication request getting to the PAM responder, but receiving an error from the back end, check the back end logs. An example error output might look like:
<pre class="wiki">[sssd[pam]] [sss_dp_issue_request] (0x0400): Issuing request for [0x411d44:3:admin@ipa.example.com]
[sssd[pam]] [sss_dp_get_account_msg] (0x0400): Creating request for [ipa.example.com][3][1][name=admin]
[sssd[pam]] [sss_dp_internal_get_send] (0x0400): Entering request [0x411d44:3:admin@ipa.example.com]
[sssd[pam]] [sss_dp_get_reply] (0x1000): Got reply from Data Provider - DP error code: 1 errno: 11 error message: Offline
[sssd[pam]] [pam_check_user_dp_callback] (0x0040): Unable to get information from Data Provider Error: 1, 11, Offline
</pre></li></ul></li><li>The back end processes the request. This might include the equivalent of <tt>kinit</tt> done in the <tt>krb5_child</tt> process, an LDAP bind or consulting an access control list. After the back end request finishes, the result is sent back to the PAM responder.
<ul><li>For Kerberos-based (that includes the IPA and AD providers) <tt>auth_provider</tt>, look into the <tt>krb5_child.log</tt> file as well. Setting <tt>debug_level</tt> to 10 would also enable low-level Kerberos tracing information in that logfile. You can also simulate the authentication with <tt>kinit</tt>.
</li><li>If the back end's <tt>auth_provider</tt> is LDAP-based, you can simulate the authentication by performing a base-scoped bind as the user who is logging in:
<pre class="wiki">ldapsearch -x -H ldap://master.ipa.example.com -b uid=admin,cn=users,cn=accounts,dc=ipa,dc=example,dc=com -s base -W
</pre></li></ul></li><li>The PAM responder receives the result and forwards it back to the <tt>pam_sss</tt> module. The error or status message is displayed in <tt>/var/log/secure</tt> or journal.
</li></ol></li></ul><ul><li><strong>Assorted common SSSD authentication problems</strong>
<ol><li>How do I enable LDAP authentication over an unsecure connection?
<ul><li>Not possible, sorry. SSSD requires the use of either TLS or LDAPS for LDAP authentication. Perimeter security is just not enough.
</li></ul></li><li>There are no messages from <tt>pam_sss</tt> at all
<ul><li>Your PAM stack is likely misconfigured. Use the <tt>authconfig</tt> tool if available together with <tt>--enablesssdauth</tt>.
</li></ul></li><li>I can <tt>su</tt> to an SSSD user from <tt>root</tt>, but not from a regular user, SSH doesn't work either
<ul><li>If you <tt>su</tt> to another user from root, you typically bypass SSSD authentication completely by using the <tt>pam_rootok.so</tt> module. Your SSSD setup is likely broken, please log in as an ordinary user and continue debugging in this section
</li></ul></li><li>I'm receiving <tt>System Error (4)</tt> in the authentication logs
<ul><li>System Error is an "Unhandled Exception" during authentication. It can either be an SSSD bug or a fatal error during authentication. Either way, please bring up your issue on the <a class="ext-link" href="https://lists.fedorahosted.org/mailman/admin/sssd-users"><span class="icon">​</span>sssd-users</a> mailing list.
</li></ul></li><li>I'm receiving <tt>Access denied for user $user: 6 (Permission denied)</tt>
<ul><li>Authentication went fine, but the user was denied access to the client machine. You can temporarily disable access control with setting <tt>access_provider=permit</tt> temporarily. Don't forget to reset the access provider to a stricter setting after finding out the root cause!
</li><li>If disabling access control doesn't help, the account might be locked on the server side. Check the SSSD domain logs to find out more.
</li></ul></li><li>I can't get my LDAP-based access control filter right for group access control using the <tt>memberOf</tt> attribute
<ul><li>The LDAP-based access control is really tricky to get right and doesn't typically handle nested groups well. Use the <a class="ext-link" href="https://jhrozek.fedorapeople.org/sssd/git/man/sssd-simple.5.html"><span class="icon">​</span>simple access provider</a> instead.
</li></ul></li></ol></li></ul><ul><li><strong>Common IPA provider issues</strong>
<ol><li>In an IPA-AD trust setup, IPA users can log in, but AD users can't
<ul><li>Unless you use a "legacy client" such as <tt>nss_ldap</tt>, then IPA users authenticate against the IPA server, but AD users authenticate against the AD servers directly. Therefore, you can test the authentication directly with <tt>kinit</tt>. Use <tt>KRB5_TRACE</tt> for extra tracing information.
</li></ul></li><li>HBAC rules keep denying access.
<ul><li>Use the <tt>ipa hbactest</tt> utility on the IPA server to see if the user is permitted access. The SSSD uses the same code as `ipa hbactest.
</li></ul></li></ol></li></ul><h2 id="Bugreports">Bug reports</h2>
<p>
If you believe you have found a bug in SSSD, please follow <a class="wiki" href="https://docs.pagure.org/sssd-test2/Reporting_sssd_bugs.html">this page</a> and file a bug report.
</p>
</body></html>